!function(e){"function"==typeof window.define?window.define.amd?window.define(e):window.define.cmd?window.define(function(t,n,r){return e}):e():"object"==typeof module&&"object"==typeof module.exports?module.exports=e():window.Simple=e()}(function(){function e(){}function t(e,t,n){this.type=e,this.key=t,this.props=n}function n(e){return u.isString(e)||u.isNumber(e)?new r(e):u.isObject(e)&&u.isString(e.type)?new i(e):u.isObject(e)&&u.isFunction(e.type)?new c(e):void 0}function r(e){this._currentElement=""+e,this._rootNodeID=null}function i(e){this._currentElement=e,this._rootNodeID=null}function o(e,t){if(null!=e&&null!=t){var n=typeof e,r=typeof t;return"string"===n||"number"===n?"string"===r||"number"===r:"object"===r&&e.type===t.type&&e.key===t.key}return!1}function s(e){var t,n={};return u.each(e,function(e,r){t=e&&e._currentelement&&e._currentelement.key?e._currentelement.key:r.toString(36),n[t]=e}),n}function a(e,t){var r={};return t=t||[],t.forEach(function(t,i){if(t){var s=e&&e[i],a=s&&s._currentElement,d=t;if(o(a,d))s.receiveComponent(d),r[i]=s;else{var c=n(d);r[i]=c}}}),r}function d(e,t,n){var r=e.childNodes[n];t instanceof HTMLElement?r?e.insertBefore(t,r):e.insertBefore(t,null):r?e.insertAdjacentHTML("afterBegin",t):e.insertAdjacentHTML("beforeend",t)}function c(e){this._currentElement=e,this._rootNodeID=null,this._instance=null}var u={each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e)===!1)return!1}else for(var o in e)if(e.hasOwnProperty(o)&&t.call(n,e[o],o,e)===!1)return!1},extend:function(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e}};["String","Function","Array","Number","RegExp","Object","Date"].forEach(function(e){u["is"+e]=function(t){return{}.toString.call(t)==="[object "+e+"]"}});var h={addListener:function(e,t){var n=this,r=e.split(" ");return this.hasOwnProperty("listeners")||this.listeners||(this.listeners={}),r.forEach(function(e){n.listeners[e]||(n.listeners[e]=[]),n.listeners[e].push(t)}),this},on:function(e,t){return this.addListener(e,t)},once:function(e,t){function n(){return this.removeListener(e,n),t.apply(this,arguments)}return this.addListener(e,n)},removeListener:function(e,t){var n,r,i,o=this;return 0===arguments.length?(this.listeners={},this):(n=e.split(" "),n.forEach(function(e){if(i=null!=(r=o.listeners)?r[e]:void 0)return t?void i.forEach(function(e,n){e===t&&(i.splice(n,1),o.listeners[e]=i)}):delete o.listeners[e]}),this)},off:function(e,t){return this.removeListener(e,t)},listenerList:function(e){return this.listeners[e]},emit:function(){var e,t,n,r,i=this;if(e=arguments.length>=1?[].slice.call(arguments,0):[],n=e.shift(),r=null!=(t=this.listeners)?t[n]:void 0)return r.forEach(function(t){t.apply(i,e)}),!0}};e.prototype={render:function(){},setState:function(e){this._simpleInternalInstance.receiveComponent(null,e)}},r.prototype={mountComponent:function(e){return this._rootNodeID=e,this._currentElement},receiveComponent:function(e){var t=""+e;t!==this._currentElement&&(this._parentNode.innerHTML=t,this._currentElement=t)}};var l=0,p=[],f={MOVE_EXISTING:1,REMOVE_NODE:2,INSERT_NODE:3};i.prototype={mountComponent:function(e){var t=this;this._rootNodeID=e;var r=this._currentElement.props,i=r.children||[],o=document.createElement(this._currentElement.type);o.setAttribute("data-simpleid",this._rootNodeID),u.each(r,function(e,n){if(/^on[A-Za-z]/.test(n)){var r=n.toLowerCase().replace("on","");t.addListener(o,r,e)}e&&"children"!==n&&"ref"!==n&&!/^on[A-Za-z]/.test(n)&&o.setAttribute(n,e)});var s=[],a={};return i.forEach(function(e,r){if(e){var i=n(e);if(i._mountIndex=r,u.isString(e)||u.isNumber(e))i._parentNode=o;else{var d=e.props.ref;d&&(a[d]=i)}s.push(i);var c=t._rootNodeID+"."+r,h=i.mountComponent(c);u.each(i._childrenRefs,function(e,t){a[t]=e}),h&&h instanceof HTMLElement?o.appendChild(h):o.insertAdjacentHTML("beforeend",h)}}),this._renderedChildren=s,this._childrenRefs=a,this._nativeNode=o},receiveComponent:function(e){var t=this._currentElement.props,n=e.props;this._updateDOMProperties(t,n),this._updateDOMChildren(e.props.children),this._currentElement=e},addListener:function(e,t,n){var r=this;this.hasOwnProperty("listeners")||this.listeners||(this.listeners={}),r.listeners[t]||(r.listeners[t]=[]),r.listeners[t].push(n),e.addEventListener(t,n)},removeListener:function(e,t,n){var r,i=this;if(r=null!=i.listeners?i.listeners[t]:void 0)return n?void r.forEach(function(o,s){o===n&&(e.removeEventListener(t,o),r.splice(s,1),i.listeners[t]=r)}):delete i.listeners[t]},_updateDOMProperties:function(e,t){var n,r=this;for(n in e)if(!t.hasOwnProperty(n)&&e.hasOwnProperty(n)){if(/^on[A-Za-z]/.test(n)){var i=n.toLowerCase().replace("on","");r.removeListener(r._nativeNode,i,e[n])}this._nativeNode.removeAttribute(n)}for(n in t)if(/^on[A-Za-z]/.test(n)){var i=n.toLowerCase().replace("on","");e[n]?(r.removeListener(r._nativeNode,i,e[n]),r.addListener(r._nativeNode,i,t[n])):r.addListener(r._nativeNode,i,t[n])}else"children"!==n&&"ref"!==n&&("value"===n&&"INPUT"===this._nativeNode.nodeName?this._nativeNode.value=t[n]:this._nativeNode.setAttribute(n,t[n]))},_updateDOMChildren:function(e){l++,this._diff(p,e),l--,0===l&&(this._patch(p),p=[])},_diff:function(e,t){var n,r=this,i=s(this._renderedChildren),o=a(i,t);this._renderedChildren=[];var d={};u.each(o,function(e){if(r._renderedChildren.push(e),!u.isString(e._currentElement)&&!u.isNumber(e._currentElement)){var t=e._currentElement.props.ref;t&&(d[t]=e),e._childrenRefs&&u.each(e._childrenRefs,function(e,t){d[t]=e})}}),this._childrenRefs=d;var c=0,h=0;for(n in o)if(o.hasOwnProperty(n)){var l=i&&i[n],p=o[n];l===p?(l._mountIndex<c&&e.push({parentID:this._rootNodeID,parentNode:this._nativeNode,type:f.MOVE_EXISTING,fromIndex:l._mountIndex,toIndex:h}),c=Math.max(l._mountIndex,c)):(l&&(e.push({parentID:this._rootNodeID,parentNode:this._nativeNode,type:f.REMOVE_NODE,fromIndex:l._mountIndex,toIndex:null}),c=Math.max(l._mountIndex,c)),e.push({parentID:this._rootNodeID,parentNode:this._nativeNode,type:f.INSERT_NODE,fromIndex:null,toIndex:h,node:p.mountComponent(this._rootNodeID+"."+n)})),p._mountIndex=h,h++}for(n in i)!i.hasOwnProperty(n)||o&&o.hasOwnProperty(n)||e.push({parentID:this._rootNodeID,parentNode:this._nativeNode,type:f.REMOVE_NODE,fromIndex:i[n]._mountIndex,toIndex:null})},_patch:function(e){var t={},n=[];u.each(e,function(e){if(e.type===f.MOVE_EXISTING||e.type===f.REMOVE_NODE){var r=e.fromIndex,i=e.parentNode.childNodes[r],o=e.parentID;t[o]=t[o]||[],t[o][r]=i,n.push(i)}}),u.each(n,function(e){e.parentNode.removeChild(e)}),u.each(e,function(e){switch(e.type){case f.INSERT_NODE:d(e.parentNode,e.node,e.toIndex);break;case f.MOVE_EXISTING:d(e.parentNode,t[e.parentID][e.fromIndex],e.toIndex);break;case f.REMOVE_NODE:}})}},c.prototype={mountComponent:function(e){var t=this;this._rootNodeID=e;var r=this._currentElement.props,i=this._currentElement.type,o=new i(r);this._instance=o,o._simpleInternalInstance=this,o.componentWillMount&&o.componentWillMount();var s=this._instance.render();if(u.isString(s)){var a=_.createElement("span",null,[s]);s=a}var d=n(s);return this._renderedComponent=d,this._nativeNode=d.mountComponent(this._rootNodeID),u.each(this._renderedComponent._childrenRefs,function(e,n){e instanceof c?t._instance.refs[n]=e._instance:t._instance.refs[n]=e._nativeNode}),_.on("mountReady",function(){o.componentDidMount&&o.componentDidMount()}),this._nativeNode},receiveComponent:function(e,t){var r=this;this._currentElement=e||this._currentElement;var i=this._instance,s=u.extend(i.state,t),a=this._currentElement.props;if(i.state=s,i.props=a,!i.shouldComponentUpdate||i.shouldComponentUpdate(a,s)!==!1){i.componentWillUpdate&&i.componentWillUpdate(a,s);var d=this._renderedComponent,h=d._currentElement,l=i.render();if(o(h,l))d.receiveComponent(l),r._instance.refs={},u.each(this._renderedComponent._childrenRefs,function(e,t){e instanceof c?r._instance.refs[t]=e._instance:r._instance.refs[t]=e._nativeNode}),i.componentDidUpdate&&i.componentDidUpdate();else{if(u.isString(l)){var p=_.createElement("span",null,[l]);l=p}this._renderedComponent=n(l);var f=this._renderedComponent.mountComponent(this._rootNodeID);this._nativeNode.parentNode.replaceChild(f,this._nativeNode),this._nativeNode=f}}}};var _={nextSimpleRootIndex:0,createClass:function(t){var n=function(e){this.props=this.getDefaultProps?u.extend({},this.getDefaultProps(),e):e,this.state=this.getInitialState?this.getInitialState():null,this.refs={}};return n.prototype=new e,n.prototype.constructor=n,u.extend(n.prototype,t),n},createElement:function(e,n,r){var i,o={};n=n||{};var s=n.key||null;for(i in n)n.hasOwnProperty(i)&&"key"!==i&&(o[i]=n[i]);var a=arguments.length-2;if(1===a)o.children=u.isArray(r)?r:[r];else if(a>1){for(var d=Array(a),c=0;c<a;c++)d[c]=arguments[c+2];o.children=d}return new t(e,s,o)},render:function(e,t){var r=n(e),i=r.mountComponent(_.nextSimpleRootIndex++);return i&&i instanceof HTMLElement?t.appendChild(i):t.insertAdjacentHTML("beforeend",i),this.emit("mountReady"),i},utils:u};return u.extend(_,h),_});